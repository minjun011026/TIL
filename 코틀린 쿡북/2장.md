# 2장

## Smart Cast 와 Safe Cast
```kotlin
data class Address(
    val city: String, 
    val state: String?, 
    val country: String
)

val address1 = Address("Seoul", null, "South Korea")
```
이러한 `Address` 클래스가 있을 때

```kotlin
if(address1.state != null)
    val stateLength = address1.state.length
```
이와 같이 if문에서 state 속성이 null이 아닌 값을 가지고 있는지 확인하면   
해당 속성이 마치 nullable하지 않은 것처럼 영리한 타입 전환 Smart Cast를 한다.

하지만 모든 상황에서 이러한 Smart Cast를 할 수 있는 것은 아니다.   
위의 상황에서는 `address1`이 `val`로 선언되어있기 때문에 가능한 것이다.
```kotlin
var address1 = Address("Seoul", null, "South Korea")
```
만약 위와 같이 `var`로 선언되었다면 `address1`의 state에 접근하는 시점에 **값이 변경되었을 수 있다고 가정하고 Smart Cast를 수행하지 않는다**.

이를 우회하고자 `!!` assert 연산자를 사용할 수 있지만 이것이 하나라도 있으면 code smell(잠재적으로 문제가 있는 코드)로 최대한 지양해야 한다.

이런 상황에서 `?.` 연산자를 사용해주는 것이 안전하다. 하지만 이것은 초기에 의도한 타입이 아닌 nullable한 타입이 리턴된다.   
그렇기에 엘비스 연산자 `?:`를 함께 사용해준다.
```kotlin
val stateLength = address1.state?.length ?: 0
```
+ `?:` : 자신의 왼쪽이 null일 경우 오른쪽의 값을 반환한다. 이때 오른쪽은 식으로 `return`이나 `throw`를 사용할 수 있다.

```kotlin
val address2 = address1 as? Address
```
코틀린은 `as?` 라는 Safe Cast 연산자를 지원한다. 이것은 타입 변환이 실패했을 때 null을 반환한다 즉 타입은 `Address?`

엘비스 연산자라고 불리는 것에 의문을 가진 적이 없었는데 이번에 갑자기 궁금해서 찾아보니 이유가 '가수 엘비스 프레슬리를 닮아서'였다....   
코틀린 개발자라면 이정도 유머감각은 있어야 하나..

## Java에 null 허용 지시자 추가하기
이것은 코틀린코드가 자바와 상호작용이 필요하고 이때 null 허용 어노테이션을 강제하고 싶을 때 사용할 수 있는 방법이다.   
아직 이 방법이 필요한 순간이 오지 않고 사용해본 적도 없어 잘 감이 오지 않는 내용이다. 하지만 기존 안드로이드 프로젝트들이 코틀린이 아닌 자바로 만들어진 것도 많기 때문에 알아두면 나쁠 것 없는 내용이라고 생각한다.

방법은 간단하다. 안드로이드 프로젝트의 app단위 gradle파일에서 확인 할 수 있는 `kotlinOptions`에 `freeCompilerArgs = listOf("-Xjsr305=strict")`를 추가해주면 된다.
```kotlin
kotlinOptions {
        jvmTarget = "11"
        freeCompilerArgs = listOf("-Xjsr305=strict")
    }
```
